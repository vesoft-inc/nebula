# 作业管理（Job Manager）

作业特指在存储层运行的两个命令 compact 和 flush。管理指对作业进行管理。比如让作业排队执行、查看作业状态、停止作业、恢复作业等。

## 命令列表

### admin compact / flush

执行 `admin flush` 命令后，如果成功，会返回这个作业的 ID。示例返回结果如下：

```ngql
==============
| New Job Id |
==============
| 40         |
--------------
```

### SHOW JOB

#### 返回单个作业信息

命令 `SHOW JOB <job_id>` 用于返回对应 ID 作业信息。

```ngql
nebula> SHOW JOB 40
=====================================================================================
| Job Id(TaskId) | Command(Dest) | Status   | Start Time        | Stop Time         |
=====================================================================================
| 40             | flush nba     | finished | 12/17/19 17:21:30 | 12/17/19 17:21:30 |
-------------------------------------------------------------------------------------
| 40-0           | 192.168.8.5   | finished | 12/17/19 17:21:30 | 12/17/19 17:21:30 |
-------------------------------------------------------------------------------------
```

执行上述命令将返回 1 到多行结果，取决于 space 所在的 storage 个数。
第一行第二列代表这个作业的逻辑信息。第二行第二列代表这个作业具体在哪台机器执行。

#### 返回所有作业信息

命令 `SHOW JOBS` 用于列出所有作业信息(实际上是没有被归档的作业，如何归档见下节)。

```ngql
nebula> SHOW JOBS
=============================================================================
| Job Id | Command       | Status   | Start Time        | Stop Time         |
=============================================================================
| 22     | flush test2   | failed   | 12/06/19 14:46:22 | 12/06/19 14:46:22 |
-----------------------------------------------------------------------------
| 23     | compact test2 | stopped  | 12/06/19 15:07:09 | 12/06/19 15:07:33 |
-----------------------------------------------------------------------------
| 24     | compact test2 | stopped  | 12/06/19 15:07:11 | 12/06/19 15:07:20 |
-----------------------------------------------------------------------------
| 25     | compact test2 | stopped  | 12/06/19 15:07:13 | 12/06/19 15:07:24 |
-----------------------------------------------------------------------------
```

### BACKUP JOB

命令 `BACKUP JOB <from_id> <to_id>` 用于在作业过多时将作业归档。归档后的作业在客户端中不再可见。且 SHOW 一个已归档的作业将会报错。

```ngql
nebula> BACKUP JOB 0 22
=========================
| BACKUP Result         |
=========================
| backup 1 jobs 2 tasks |
-------------------------
```

### RECOVER JOB

命令 `RECOVER JOB <job_id>` 用于重新执行指定作业，并返回新的作业 ID。

```ngql
nebula> RECOVER JOB 40
==============
| New Job Id |
==============
| 41         |
--------------
```