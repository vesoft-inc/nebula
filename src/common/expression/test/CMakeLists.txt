# Copyright (c) 2020 vesoft inc. All rights reserved.
#
# This source code is licensed under Apache 2.0 License.

set(expression_test_common_libs
    parser_obj
    expression_obj
    network_obj
    fs_obj
    stats_obj
    graph_stats_obj
    meta_client_stats_obj
    storage_client_stats_obj
    datatypes_obj
    time_obj
    datetime_parser_obj
    common_thrift_obj
    thrift_obj
    thread_obj
    base_obj
    function_manager_obj
    wkt_wkb_io_obj
    agg_function_manager_obj
    meta_thrift_obj
    graph_thrift_obj
    http_client_obj
    storage_thrift_obj
    meta_obj
    meta_client_obj
    conf_obj
    charset_obj
    file_based_cluster_id_man_obj
    process_obj
    time_utils_obj
    ft_es_graph_adapter_obj
    ws_common_obj
    version_obj
    graph_session_obj
    graph_flags_obj
    util_obj
    expr_visitor_obj
    graph_context_obj
    plan_obj
    idgenerator_obj
    graph_obj
    ssl_obj
    memory_obj
)


if(ENABLE_STANDALONE_VERSION)
set(expression_test_common_libs
    ${expression_test_common_libs}
    sa_test_graph_flags_obj
)
endif()

nebula_add_library(
    expr_ctx_mock_obj SHARED
    ExpressionContextMock.cpp
    TestBase.cpp
)

nebula_add_test(
    NAME
        expression_test
    SOURCES
        ExpressionTest.cpp
        EncodeDecodeTest.cpp
        AggregateExpressionTest.cpp
        ArithmeticExpressionTest.cpp
        AttributeExpressionTest.cpp
        CaseExpressionTest.cpp
        ColumnExpressionTest.cpp
        ConstantExpressionTest.cpp
        ContainerExpressionTest.cpp
        FunctionCallExpressionTest.cpp
        LabelExpressionTest.cpp
        ListComprehensionExpressionTest.cpp
        LogicalExpressionTest.cpp
        RelationalExpressionTest.cpp
        PathBuildExpressionTest.cpp
        PropertyExpressionTest.cpp
        PredicateExpressionTest.cpp
        ReduceExpressionTest.cpp
        SubscriptExpressionTest.cpp
        TypeCastingExpressionTest.cpp
        VersionedVariableExpressionTest.cpp
    LIBRARIES
        expr_ctx_mock_obj
        ${expression_test_common_libs}
    LIBRARIES
        gtest
        ${THRIFT_LIBRARIES}
        ${PROXYGEN_LIBRARIES}
)

nebula_add_executable(
    NAME
        expression_bm
    SOURCES
        ExpressionBenchmark.cpp
    LIBRARIES
        expr_ctx_mock_obj
        ${expression_test_common_libs}
    LIBRARIES
        follybenchmark
        boost_regex
        ${THRIFT_LIBRARIES}
        ${PROXYGEN_LIBRARIES}
)

nebula_add_executable(
    NAME
        func_call_expression_bm
    SOURCES
        FunctionCallExpressionBenchmark.cpp
    LIBRARIES
        expression_obj
        datatypes_obj
        base_obj
        expr_ctx_mock_obj
        function_manager_obj
        wkt_wkb_io_obj
        time_obj
        time_utils_obj
        datetime_parser_obj
        fs_obj
        agg_function_manager_obj
    LIBRARIES
        follybenchmark
        boost_regex
        ${THRIFT_LIBRARIES}
)

nebula_add_executable(
    NAME
        aggregate_expression_bm
    SOURCES
        AggregateExpressionBenchmark.cpp
    LIBRARIES
        expression_obj
        datatypes_obj
        base_obj
        expr_ctx_mock_obj
        function_manager_obj
        wkt_wkb_io_obj
        agg_function_manager_obj
        time_obj
        time_utils_obj
        datetime_parser_obj
        fs_obj
    LIBRARIES
        follybenchmark
        boost_regex
        ${THRIFT_LIBRARIES}
)
