set(WAL_TEST_LIBS
    wal_obj
    disk_man_obj
    meta_thrift_obj
    common_thrift_obj
    storage_thrift_obj
    datatypes_obj
    base_obj
    thread_obj
    fs_obj
    time_obj
    thread_obj
    wkt_wkb_io_obj
)

nebula_add_test(
    NAME
        file_based_wal_test
    SOURCES
        FileBasedWalTest.cpp
)
target_link_libraries(
        file_based_wal_test
        PRIVATE
        ${WAL_TEST_LIBS}
        gtest
        ${THRIFT_LIBRARIES}
        ${NEBULA_LIBS}
)

nebula_add_test(
    NAME
        inmemory_log_buffer_test
    SOURCES
        InMemoryLogBufferTest.cpp
        InMemoryLogBuffer.cpp
)

target_link_libraries(
        inmemory_log_buffer_test
        PRIVATE
        ${WAL_TEST_LIBS}
        ${THRIFT_LIBRARIES}
        gtest
        ${THRIFT_LIBRARIES}
        ${NEBULA_LIBS}
)
nebula_add_test(
    NAME
        atomic_log_buffer_test
    SOURCES
        AtomicLogBufferTest.cpp
)
target_link_libraries(
        atomic_log_buffer_test
        PRIVATE
        ${WAL_TEST_LIBS}
        gtest
        ${THRIFT_LIBRARIES}
        ${NEBULA_LIBS}
)

nebula_add_executable(
    NAME
        log_bufferr_bm
    SOURCES
        LogBufferBenchmark.cpp
        InMemoryLogBuffer.cpp
)

target_link_libraries(
        log_bufferr_bm
        PRIVATE
        ${WAL_TEST_LIBS}
        follybenchmark
        boost_regex
        ${THRIFT_LIBRARIES}
        ${NEBULA_LIBS}
)
nebula_add_test(
    NAME
        wal_file_iter_test
    SOURCES
        WalFileIterTest.cpp
)
target_link_libraries(
        wal_file_iter_test
        PRIVATE
        ${WAL_TEST_LIBS}
        gtest
        ${THRIFT_LIBRARIES}
        ${NEBULA_LIBS}
)
